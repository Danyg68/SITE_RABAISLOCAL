# ğŸ“Š SCHÃ‰MA DES DÃ‰PENDANCES & FLUX MAKE â€“ RabaisLocal V2.0

---

## 1. ARCHITECTURE GLOBALE â€“ DÃ©pendances entre phases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PHASE 0: PRÃ‰-DEV (Sem 1)                   â”‚
â”‚  Setup Make + Specs IA + RACI + Repo Git â†’ Foundation prÃªte    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                     â”‚                  â”‚
        â–¼                                     â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PHASE 1:         â”‚          â”‚  PHASE 1.5: IA+Make  â”‚   â”‚  ParallÃ¨le:   â”‚
â”‚  Base Tech        â”‚          â”‚  Setup Fallback      â”‚   â”‚  Infrastructure
â”‚  (Sem 1-3)        â”‚          â”‚  (Sem 3-4)           â”‚   â”‚  Dev/Test Env
â”‚  - Auth           â”‚          â”‚  - Proxy IA          â”‚   â”‚               
â”‚  - RBAC           â”‚          â”‚  - Claude setup      â”‚   â”‚               
â”‚  - GoAffPro link  â”‚          â”‚  - OpenAI setup      â”‚   â”‚               
â”‚  - Users table    â”‚          â”‚  - Gemini setup      â”‚   â”‚               
â”‚  - JWT            â”‚          â”‚  - Make scenarios    â”‚   â”‚               
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   PHASE 2: CrÃ©dits + Mock Paiement (S 4-5)â”‚
         â”‚   - tables credits_wallet                 â”‚
         â”‚   - MOCK endpoint /api/mock-payment       â”‚
         â”‚   - Payments.AI + PayPal (parallÃ¨le)      â”‚
         â”‚   - Dashboard crÃ©dits                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                             â”‚
      â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3:             â”‚   â”‚ PHASE 4:                 â”‚
â”‚ Offres & Promos      â”‚   â”‚ CommerÃ§ants (Sem 7-8)    â”‚
â”‚ (Sem 5-7)            â”‚   â”‚ - Dashboard              â”‚
â”‚ - table offers       â”‚   â”‚ - IA creator             â”‚
â”‚ - IA generator       â”‚â—„â”€â”€â”¤ - Plan manager           â”‚
â”‚ - RÃ©servation        â”‚   â”‚ - Auto-renew             â”‚
â”‚ - Notifications      â”‚   â”‚ - Stats                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 5:             â”‚
â”‚ AffiliÃ©s (Sem 8-9)   â”‚
â”‚ - GoAffPro sync      â”‚
â”‚ - Dashboard affiliÃ©  â”‚
â”‚ - Contrats           â”‚
â”‚ - Auto-debit         â”‚
â”‚ - Rangs progression  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 6:             â”‚
â”‚ Agents IA (S 9-10)   â”‚
â”‚ - Agent commerÃ§ant   â”‚
â”‚ - Agent affiliÃ©      â”‚
â”‚ - Agent consommateur â”‚
â”‚ - Canva API          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 7:             â”‚
â”‚ Paiements (S 10-11)  â”‚
â”‚ - Hub centralisÃ©     â”‚
â”‚ - Auto-renew plans   â”‚
â”‚ - Redistribution 51% â”‚
â”‚ - Factures/rapports  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 8:             â”‚
â”‚ Admin (Sem 11-12)    â”‚
â”‚ - Dashboard admin    â”‚
â”‚ - Monitoring         â”‚
â”‚ - Alertes            â”‚
â”‚ - Rapports hebdo     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 10-11:         â”‚
â”‚ Tests + UAT (S 12-14)â”‚
â”‚ - Unit tests         â”‚
â”‚ - UAT par rÃ´le       â”‚
â”‚ - Load testing       â”‚
â”‚ - Recrutement 50 aff â”‚
â”‚ - Go-live!           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. FLUX MAKE â€“ Orchestration des automatisations

### ScÃ©nario 1: Inscription Utilisateur â†’ GoAffPro

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MAKE SCENARIO #1: Utilisateur inscrit â†’ CrÃ©er dans GoAffPro    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRIGGER (Webhook ClickFunnels ou Supabase)
   â”‚
   â”œâ”€ Capture: {email, nom, role, referred_by_id}
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Router (if/else)                   â”‚
â”‚ â”œâ”€ Role = "affiliate"?             â”‚
â”‚ â”œâ”€ Role = "merchant"?              â”‚
â”‚ â””â”€ Role = "consumer"?              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”œâ”€ [SI AFFILIATE] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                          â”‚
   â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ HTTP Request â†’ GoAffPro API        â”‚                       â”‚
â”‚ POST /admin/affiliates             â”‚                       â”‚
â”‚ {                                  â”‚                       â”‚
â”‚   email,                           â”‚                       â”‚
â”‚   name,                            â”‚                       â”‚
â”‚   referred_by: referred_by_id,     â”‚                       â”‚
â”‚   commission_group: "affiliate_v2" â”‚                       â”‚
â”‚ }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
   â”‚                                                          â”‚
   â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ Update Supabase users table        â”‚                       â”‚
â”‚ SET goaffpro_id = response.id      â”‚                       â”‚
â”‚ WHERE email = ...                  â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
   â”‚                                                          â”‚
   â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ HTTP Request â†’ Gmail API (SMTP)    â”‚                       â”‚
â”‚ Send Email: Bienvenue affiliate!   â”‚                       â”‚
â”‚ + Contrat PDF en piÃ¨ce jointe      â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
   â”‚                                                          â”‚
   â–¼                                                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚ Google Sheets: Log inscription     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ [affiliate_inscriptions tab]        â”‚
â”‚ + Timestamp + Source                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â””â”€ ERROR HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                                  â”‚
      â–¼                                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚ Si GoAffPro fail:                  â”‚                 â”‚
â”‚ - Log error en Google Sheets       â”‚                 â”‚
â”‚ - Slack alert #errors              â”‚                 â”‚
â”‚ - Retry aprÃ¨s 5 min                â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
                                                        â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          [END - Utilisateur OK]
```

### ScÃ©nario 2: Paiement ValidÃ© â†’ Commission AffiliÃ© + Email

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAKE SCENARIO #2: Paiement â†’ Commissions + Notifications        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRIGGER: Webhook Payments.AI (payment.success)
   â”‚
   â”œâ”€ Payload: {transaction_id, user_id, amount, type, plan}
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Router: Type de paiement?          â”‚
â”‚ â”œâ”€ merchant_plan_renewal           â”‚
â”‚ â”œâ”€ credits_purchase                â”‚
â”‚ â”œâ”€ affiliate_trousse               â”‚
â”‚ â””â”€ affiliate_monthly               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â”œâ”€ [SI AFFILIATE PAIEMENT] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚                                                 â”‚
   â–¼                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ HTTP Request â†’ GoAffPro API        â”‚              â”‚
â”‚ POST /admin/commissions/calc       â”‚              â”‚
â”‚ { affiliate_id, transaction_id,    â”‚              â”‚
â”‚   amount, type }                   â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â”‚                                                 â”‚
   â–¼                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ Parse GoAffPro Response            â”‚              â”‚
â”‚ Extract:                           â”‚              â”‚
â”‚ - commission_direct (%)            â”‚              â”‚
â”‚ - commission_n2, n3... (%)         â”‚              â”‚
â”‚ - total_commission ($)             â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â”‚                                                 â”‚
   â–¼                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ Update Supabase affiliate_comm     â”‚              â”‚
â”‚ INSERT commission log              â”‚              â”‚
â”‚ + Update affiliate.total_earned    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â”‚                                                 â”‚
   â–¼                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚ Check: balance >= $30 for payout?  â”‚              â”‚
â”‚ IF YES â†’ trigger PAYOUT FLOW       â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
   â”‚                                                 â”‚
   â”œâ”€ YES (balance â‰¥ $30) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
   â”‚                                       â”‚        â”‚
   â”‚  â–¼                                    â”‚        â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
   â”‚ â”‚ PayPal Transfer via Make         â”‚  â”‚        â”‚
   â”‚ â”‚ POST /payments/payout            â”‚  â”‚        â”‚
   â”‚ â”‚ amount = affiliate.balance       â”‚  â”‚        â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
   â”‚   â”‚                                  â”‚        â”‚
   â”‚   â–¼                                  â”‚        â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
   â”‚ â”‚ Supabase: Log payout + reset     â”‚  â”‚        â”‚
   â”‚ â”‚ affiliate.balance = 0            â”‚  â”‚        â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
   â”‚   â”‚                                  â”‚        â”‚
   â”‚   â–¼                                  â”‚        â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚        â”‚
   â”‚ â”‚ Email notification:              â”‚  â”‚        â”‚
   â”‚ â”‚ "Vous avez reÃ§u $XXX!"          â”‚  â”‚        â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚
   â”‚                                       â”‚        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
                                          â”‚        â”‚
   â””â”€ NO (balance < $30) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
                                          â”‚        â”‚
      â–¼                                   â”‚        â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
    â”‚ Email notification:              â”‚   â”‚        â”‚
    â”‚ "Commission enregistrÃ©e: $XXX"  â”‚   â”‚        â”‚
    â”‚ "AccumulÃ©: $YYY"                â”‚   â”‚        â”‚
    â”‚ (Payout seul si â‰¥$30)            â”‚   â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
      â”‚                                    â”‚        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
                                           â”‚        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                    â”‚                               â”‚
                    â–¼                               â”‚
            [END - Commissions OK] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ScÃ©nario 3: Contrat d'Affiliation + Signature

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAKE SCENARIO #3: GÃ©nÃ©rer Contrat + Demander Signature          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TRIGGER: AffiliÃ© inscrit (role = affiliate)
   â”‚
   â”œâ”€ Input: {affiliate_id, email, name, plan}
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RÃ©cupÃ©rer donnÃ©es affiliÃ©          â”‚
â”‚ from Supabase                      â”‚
â”œâ”€ email                            â”‚
â”œâ”€ name                             â”‚
â”œâ”€ phone                            â”‚
â”œâ”€ adresse                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GÃ©nÃ©rer PDF via Make               â”‚
â”‚ Template: Contrat_Affiliation.pdf  â”‚
â”‚ Merge fields: {name, email, date}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload PDF â†’ Google Drive          â”‚
â”‚ Folder: /Contrats_Affilies/YYYY/MM â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GÃ©nÃ©rer lien signature (DocuSign)  â”‚
â”‚ POST /signature/create             â”‚
â”‚ {pdf_url, email, name}             â”‚
â”‚ â†’ retourne signing_url             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Email Ã  l'affiliÃ©:                 â”‚
â”‚ Objet: "Veuillez signer votre      â”‚
â”‚ contrat d'affiliation"             â”‚
â”‚ Body: signing_url                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚
   â””â”€ WEBHOOK LISTENER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                                    â”‚
      â”œâ”€ Attendre signature (DocuSign webhook)           â”‚
      â”‚                                                   â”‚
      â–¼                                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ TRIGGER: document.signed           â”‚               â”‚
    â”‚ (webhook DocuSign â†’ Make)          â”‚               â”‚
    â”‚                                    â”‚               â”‚
    â”‚ â”œâ”€ envelope_status = "completed"  â”‚               â”‚
    â”‚ â””â”€ signed_url = path to PDF       â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                                                   â”‚
      â–¼                                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Download signed PDF                â”‚               â”‚
    â”‚ Store in Supabase Storage          â”‚               â”‚
    â”‚ affiliate.contract_signed_path =   â”‚               â”‚
    â”‚ /contracts/{affiliate_id}/signed   â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                                                   â”‚
      â–¼                                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Update Supabase:                   â”‚               â”‚
    â”‚ affiliates.contract_signed = true  â”‚               â”‚
    â”‚ affiliates.signed_at = NOW()       â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                                                   â”‚
      â–¼                                                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ Email de confirmation:             â”‚               â”‚
    â”‚ "Contrat signÃ©! Bienvenue"        â”‚               â”‚
    â”‚ + PDF signÃ© en piÃ¨ce jointe       â”‚               â”‚
    â”‚ + Lien Go-live tableau de bord    â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                                                   â”‚
      â–¼                                                   â”‚
    [END - Contrat OK] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. DÃ‰PENDANCES CRITIQUES â€“ Graphe de blocages

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 0 (Sem 1)                     â”‚
â”‚ - Schema Make                       â”‚
â”‚ - Specs IA                          â”‚
â”‚ - RACI                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ BLOQUE: 1, 1.5, 2
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                  â”‚
    â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1        â”‚        â”‚ PHASE 1.5                  â”‚
â”‚ Auth + RBAC    â”‚â”€â”€â”€â”€â”   â”‚ IA + Make                  â”‚
â”‚ (Sem 1-3)      â”‚    â”‚   â”‚ (Sem 3-4)                  â”‚
â”‚ BLOCKING       â”‚    â”‚   â”‚ BLOCKING Phase 2,3         â”‚
â”‚ EVERYTHING     â”‚    â”‚   â”‚                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ (CRITICAL)     â”‚                â”‚ (CRITICAL)
     â”‚                â”‚                â”‚
     â–¼                â–¼                â–¼
     [GoAffPro API]   [Proxy IA]   [Make Hooks]
     [JWT tokens]     [Fallback]   [Scenarios]
     [RLS Policies]                [Retry Logic]
     
     All depend on: PostgreSQL + Supabase setup
     â”‚
     â–¼ READY (sem 3-4)
     â”‚
     â”œâ”€ PHASE 2 (Credits) â€“ BLOCKING Phase 3
     â”‚  Depends: Phase 1 + Phase 1.5
     â”‚
     â”œâ”€ PHASE 2: Mock paiement + real Payments.AI parallel
     â”‚
     â–¼ (BOTH ready sem 5)
     â”‚
     â”œâ”€ PHASE 3 (Offers) â€“ BLOCKING Phase 4
     â”‚  Depends: Phase 1 + Phase 2 + IA proxy
     â”‚
     â”œâ”€ PHASE 4 (Merchants) â€“ NEEDS Phase 3 + Phase 1.5 IA
     â”‚
     â–¼ (Offers+Merchants ready sem 8)
     â”‚
     â”œâ”€ PHASE 5 (AffiliÃ©s) â€“ NEEDS GoAffPro sync (Phase 1)
     â”‚  Depends: Phase 1 (auth) + Phase 7 (paiements)
     â”‚
     â–¼ (Sem 9+)
     â”‚
     â”œâ”€ PHASE 6 (Agents IA) â€“ NEEDS IA proxy (Phase 1.5)
     â”‚
     â”œâ”€ PHASE 7 (Paiements) â€“ NEEDS Phase 2 + Make (1.5)
     â”‚
     â–¼ (Sem 11)
     â”‚
     â”œâ”€ PHASE 8 (Admin) â€“ NEEDS all modules
     â”‚
     â–¼ (Sem 12+)
     â”‚
     â””â”€ PHASE 10-11 (Tests + Go-live)
        Needs: EVERYTHING working
```

---

## 4. MATRICE DE DÃ‰PENDANCES â€“ Qui bloque quoi ?

| Phase | DÃ©pend de | Bloque | PrioritÃ© | Risk |
|-------|-----------|--------|----------|------|
| **0** | (none) | 1, 1.5, Infra | ğŸ”¥ A | HAUTE |
| **1** | 0 | 1.5, 2, 3, 4, 5 | ğŸ”¥ A | HAUTE |
| **1.5** | 0, 1 (partiel) | 2, 3, 6 | ğŸ”¥ A | HAUTE |
| **2** | 1, 1.5 | 3, 4 | ğŸ”¥ A | HAUTE |
| **3** | 2, 1.5 (IA) | 4, 10 | ğŸ”¥ A | MOYENNE |
| **4** | 3, 1.5 (IA) | 10 | ğŸ”¥ A | MOYENNE |
| **5** | 1 (auth), 7 (paiements) | 10 | ğŸ”¥ A | HAUTE |
| **6** | 1.5 (IA proxy) | 10 | âš¡ B | MOYENNE |
| **7** | 2, 1.5 (Make) | 10 | ğŸ”¥ A | HAUTE |
| **8** | 7, 1 | 10 | âš¡ B | BASSE |
| **9** | 3, 4, 5 | (optionnel) | âš™ï¸ C | N/A |
| **10-11** | ALL | (lancement) | ğŸ”¥ A | CRITIQUE |

---

## 5. CHEMINS CRITIQUES (Critical Path)

### Chemin A: MVP minimal (prÃ©-lancement dÃ©mo)
```
Phase 0 â†’ Phase 1 â†’ Phase 2 (mock) â†’ Phase 3 â†’ Phase 10 (demo)
DurÃ©e: 10-11 semaines
Livrables: Auth + Offres + Dashboard consommateur
```

### Chemin B: Plein fonctionnel (prÃ©-lancement officiel)
```
Phase 0 â†’ Phase 1 â†’ Phase 1.5 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 â†’ Phase 5 â†’ Phase 7 â†’ Phase 10-11
DurÃ©e: 14 semaines
Livrables: Tous les modules + 50 affiliÃ©s
```

### Chemin C: ParallÃ©lisation (pour gagner temps)
```
Phase 0 (Sem 1)
â”œâ”€ Phase 1 (Sem 1-3)
â”‚  â””â”€ Phase 1.5 (Sem 3-4, parallÃ¨le avec Phase 2)
â”‚     â”œâ”€ Phase 2 (Sem 4-5)
â”‚     â”‚  â””â”€ Phase 3 (Sem 5-7)
â”‚     â”‚     â”œâ”€ Phase 4 (Sem 7-8, parallÃ¨le)
â”‚     â”‚     â””â”€ Phase 6 (Sem 9-10, parallÃ¨le)
â”‚        â””â”€ Phase 5 (Sem 8-9, peut dÃ©marrer aprÃ¨s Phase 1)
â”‚           â””â”€ Phase 7 (Sem 10-11, parallÃ¨le)
â”‚              â””â”€ Phase 8 (Sem 11-12)
â”‚                 â””â”€ Phase 10-11 (Sem 12-14)
```

**Gain potentiel:** 2-3 semaines si bonne parallÃ©lisation

---

## 6. TABLEAU RISQUES & MITIGATIONS

| Risque | ProbabilitÃ© | Impact | Mitigation |
|--------|-------------|--------|-----------|
| GoAffPro API timeout | Moyenne | Haute | Tests sandbox parallÃ¨les, retry logic Make |
| Payments.AI retard | Basse | Haute | Mock paiement en Phase 2 |
| Make webhooks instables | Moyenne | Haute | Retry x3, deadletter queue |
| PostgreSQL perfs | Basse | Moyenne | Load testing Phase 10, indexes Phase 1 |
| IA fallback Ã©choue | Basse | Moyenne | Tests fallback dÃ¨s Phase 1.5 |
| Auth Supabase RLS bugs | Basse | Critique | UAT complet Phase 1 |

---

## 7. CHECKLIST READINESS â€“ Avant de dÃ©marrer Phase 1

**PHASE 0 â€“ Ã€ complÃ©ter (Sem 1):**

- [ ] Schema Make JSON complÃ¨te (5 scÃ©narios)
- [ ] Fallback IA approuvÃ© (Claude > OpenAI > Gemini)
- [ ] Tableau RACI signÃ© par tous
- [ ] Repo Git + CI/CD live
- [ ] Keys API (Supabase, OpenAI, Claude, Payments.AI)
- [ ] Staging env configurÃ©e
- [ ] Prod env documentÃ©e (checklist dÃ©ploiement)

**Go-live Phase 1 condition:**
âœ… Toutes les cases Phase 0 cochÃ©es

---

**Document crÃ©Ã©:** SchÃ©ma dÃ©pendances & flux Make v1.0  
**Date:** Novembre 2025  
**PrÃªt:** Pour dÃ©veloppement Phase 0
