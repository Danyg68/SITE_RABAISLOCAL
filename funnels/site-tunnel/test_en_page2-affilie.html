<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalize Your Founding Affiliate Access ‚Äì RabaisLocal</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.ico">
</head>

<body style="margin:0;padding:0;background:#F5F8FF;">

    <!-- ==========================================================
BLOCK 1 - Founding Affiliate Payment Page
========================================================== -->
    <style>
        .rl-order-top {
            font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            text-align: center;
            background: #fff;
            color: #1B2240;
            line-height: 1.6;
            padding: 0 20px 40px;
            position: relative;
        }

        .rl-banner-top {
            background: #3E53A5;
            color: #fff;
            font-weight: 600;
            padding: 12px 20px;
            font-size: clamp(15px, 1.4vw, 17px);
            letter-spacing: 0.4px;
            text-transform: uppercase;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
        }

        .rl-banner-top span {
            color: #FFD500;
            font-weight: 700;
        }

        .rl-order-top h1 {
            color: #3E53A5;
            font-size: clamp(28px, 3vw, 38px);
            font-weight: 800;
            margin-top: 40px;
            margin-bottom: 14px;
        }

        .rl-order-top p {
            font-size: clamp(16px, 1.6vw, 18px);
            margin: 0 auto 20px;
            max-width: 680px;
        }

        .rl-highlight {
            color: #3E53A5;
            font-weight: 700;
        }

        .rl-order-top .video-wrapper {
            max-width: 680px;
            margin: 32px auto 0;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 6px 22px rgba(0, 0, 0, 0.12);
        }

        @media (max-width: 600px) {
            .rl-order-top {
                padding: 0 14px 32px;
            }

            .rl-banner-top {
                font-size: 14px;
                padding: 10px 14px;
            }

            .rl-order-top h1 {
                font-size: 26px;
                margin-top: 30px;
            }

            .rl-order-top p {
                font-size: 16px;
            }
        }
    </style>

    <section class="rl-order-top">
        <div class="rl-banner-top">
            ‚ö° Exclusive Offer: <span>750 Founder spots</span> only ‚Äî get <span>80% off</span> before the official launch
            in <span>January 2026</span>!
        </div>

        <h1>Finalize Your <span class="rl-highlight">RabaisLocal Founding Affiliate</span> Access</h1>
        <p>
            For only <span class="rl-highlight">$47</span>, you become one of the
            <strong>first 750 founding affiliates</strong> and get your
            <strong>complete RabaisLocal kit and Builder rank</strong> (value over $650).
        </p>
        <p>
            You will immediately receive your personal link, access to your dashboard and support groups, your AI agent,
            and much more.
            <br>üéØ Everything you need to build your automatic income starting today.
        </p>

        <div class="video-wrapper">
            <iframe width="100%" height="360" src="https://www.youtube.com/embed/aOx0oTiUJ9E"
                title="Why RabaisLocal is different" frameborder="0" allowfullscreen></iframe>
        </div>
    </section>

    <!-- ==========================================================
PAYMENT SECTION - HOSTED PAYPAL BUTTON
========================================================== -->
    <style>
        #section-paiement-affilie {
            padding: 50px 20px 60px;
            background: linear-gradient(180deg, #ffffff 0%, #F5F8FF 100%);
            text-align: center;
        }

        #section-paiement-affilie h2 {
            color: #3E53A5;
            font-size: clamp(24px, 2.8vw, 32px);
            font-weight: 800;
            margin-bottom: 12px;
            font-family: "Poppins", sans-serif;
        }

        #section-paiement-affilie p {
            font-size: 17px;
            color: #4B569A;
            margin-bottom: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            font-family: "Poppins", sans-serif;
        }

        .paypal-info-box {
            background: #FFF9E6;
            border-left: 4px solid #FFD140;
            padding: 18px 20px;
            border-radius: 8px;
            margin: 25px auto;
            max-width: 550px;
            text-align: left;
        }

        .paypal-info-box p {
            margin: 8px 0;
            font-size: 15px;
            color: #1B2240;
            line-height: 1.7;
        }

        .paypal-info-box strong {
            color: #3E53A5;
        }

        /* Email visual validation */
        #form-inscription-affilie input.valid {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.12) !important;
        }

        #form-inscription-affilie input.invalid {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.12) !important;
        }

        @media (max-width: 600px) {
            #section-paiement-affilie {
                padding: 40px 16px 50px;
            }

            #section-paiement-affilie h2 {
                font-size: 24px;
            }

            #section-paiement-affilie p {
                font-size: 16px;
            }

            .paypal-info-box {
                padding: 15px 18px;
            }

            .paypal-info-box p {
                font-size: 14px;
            }
        }
    </style>

    <section id="section-paiement-affilie">
        <h2>Step 2 ‚Äî Activate Your Affiliate Kit</h2>
        <p>Fill out the form below to finalize your secure registration for <strong>$47 CAD</strong>.</p>

        <!-- Registration Form -->
        <div style="max-width: 600px; margin: 30px auto 0;">
            <form id="form-inscription-affilie"
                style="background: #fff; padding: 30px; border-radius: 14px; box-shadow: 0 6px 20px rgba(62, 83, 165, 0.1);">

                <!-- Hidden field for reference -->
                <input type="hidden" id="ref" name="ref" value="" />

                <!-- VPN and PayPal Warning -->
                <div
                    style="background: #FFF4E6; border-left: 4px solid #FF9800; padding: 16px 18px; border-radius: 8px; margin-bottom: 20px;">
                    <p
                        style="font-size: 15px; color: #1B2240; margin: 0; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">‚ö†Ô∏è</span>
                        <strong>Important Information</strong>
                    </p>
                    <p style="font-size: 14px; color: #5A5A5A; margin: 8px 0 0 0; line-height: 1.6;">
                        <strong>VPN:</strong> If you are using a VPN, make sure to <strong>disable</strong> it or select
                        <strong>Canada</strong> as your country during PayPal checkout to avoid currency or billing
                        issues.
                    </p>
                    <p style="font-size: 14px; color: #5A5A5A; margin: 8px 0 0 0; line-height: 1.6;">
                        <strong>PayPal Confirmation:</strong> Please note that the PayPal confirmation email might be in
                        English. However, you will receive an official invoice in French/English directly from
                        RabaisLocal.
                    </p>
                </div>

                <!-- Location Verification -->
                <div id="location-warning"
                    style="background: #FFE5E5; border-left: 4px solid #D32F2F; padding: 16px 18px; border-radius: 8px; margin-bottom: 20px; display: none;">
                    <p
                        style="font-size: 15px; color: #1B2240; margin: 0; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 20px;">üåç</span>
                        <strong>Warning: Non-Canadian Location Detected</strong>
                    </p>
                    <p style="font-size: 14px; color: #5A5A5A; margin: 8px 0 0 0; line-height: 1.6;">
                        We detect that you are not in Canada (<strong id="detected-country"></strong>).
                        Please <strong>disable your VPN</strong> or check your internet connection before proceeding to
                        PayPal.
                    </p>
                    <p style="font-size: 14px; color: #D32F2F; margin: 8px 0 0 0; line-height: 1.6; font-weight: 600;">
                        ‚úì PayPal must show "Canada" as the country<br>
                        ‚úì Currency must be in Canadian Dollars (CAD)
                    </p>
                </div>

                <!-- Email -->
                <div style="margin-bottom: 20px;">
                    <label for="email"
                        style="display: block; font-family: 'Poppins', sans-serif; font-weight: 600; color: #1B2240; margin-bottom: 8px; font-size: 15px;">
                        Affiliate Email Address *
                    </label>
                    <input type="email" id="email" name="email" required placeholder="Ex: your.email@example.com"
                        style="width: 100%; padding: 12px 16px; border: 2px solid #E0E6FF; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 15px; transition: border-color 0.3s ease;"
                        onfocus="this.style.borderColor='#3E53A5'" onblur="this.style.borderColor='#E0E6FF'" />
                    <p style="font-size: 13px; color: #6B7280; margin-top: 6px; margin-bottom: 0;">
                        This allows us to track you in case of payment issues. You will complete the rest afterwards.
                    </p>
                </div>

                <!-- Hidden Referer - automatically captured from URL -->
                <input type="hidden" id="referer" name="referer" value="" />

                <!-- Submit Button -->
                <button type="button" id="btn-submit-inscription"
                    style="width: 100%; padding: 14px 20px; background: linear-gradient(135deg, #3E53A5 0%, #5068C4 100%); color: #fff; border: none; border-radius: 8px; font-family: 'Poppins', sans-serif; font-size: 16px; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(62, 83, 165, 0.3); transition: all 0.3s ease; margin-bottom: 20px;">
                    Validate and proceed to PayPal payment ‚Üí
                </button>

            </form>

            <!-- Payment Info Message -->
            <div class="paypal-info-box">
                <p><strong>üîê How it works:</strong></p>
                <p>‚úì A PayPal window will open to complete your secure payment.</p>
                <p>‚úì Once payment is complete, you will be automatically redirected to the confirmation page.</p>
                <p>‚úì You will receive your affiliate link and dashboard access by email immediately.</p>
            </div>

            <!-- Hosted PayPal Button (Hidden - submitted automatically by registration form) -->
            <div id="paypal-button-zone" style="display: none;">
                <div>
                    <style>
                        .pp-UEB6T5RGU53K2 {
                            text-align: center;
                            border: none;
                            border-radius: 0.25rem;
                            min-width: 11.625rem;
                            padding: 0 2rem;
                            height: 2.625rem;
                            font-weight: bold;
                            background-color: #FFD140;
                            color: #000000;
                            font-family: "Helvetica Neue", Arial, sans-serif;
                            font-size: 1rem;
                            line-height: 1.25rem;
                            cursor: pointer;
                        }
                    </style>
                    <form id="paypal-hosted-form" action="https://www.paypal.com/ncp/payment/UEB6T5RGU53K2"
                        method="post" target="paypal_popup"
                        style="display:inline-grid;justify-items:center;align-content:start;gap:0.5rem;">
                        <input type="hidden" name="custom" value="" id="paypal-custom-id" />
                        <!-- UPDATED FOR TEST MODE: Redirects to English Form -->
                        <input type="hidden" name="return"
                            value="https://marketing.rabaislocal.com/test_en_page2_form_affilie.html" />
                        <input type="hidden" name="cancel_return"
                            value="https://marketing.rabaislocal.com/test_en_page2-affilie.html" />
                        <input type="hidden" name="country" value="CA" />
                        <input type="hidden" name="currency_code" value="CAD" />
                        <input type="hidden" name="lc" value="CA" />
                        <input class="pp-UEB6T5RGU53K2" type="submit" value="Buy Now" />
                        <img src="assets/images/Debit_Credit_APM_0478fd3e.svg" alt="cards" />
                        <section style="font-size: 0.75rem;">Powered by <img
                                src="assets/images/paypal-wordmark-color_9bf7b654.svg" alt="paypal"
                                style="height:0.875rem;vertical-align:middle;" /></section>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- ==========================================================
BLOCK 2 - 16 Differences Section
========================================================== -->
    <style>
        .rl-differences-section {
            background: linear-gradient(180deg, #F5F8FF 0%, #FFFFFF 100%);
            padding: 70px 20px 60px;
            font-family: "Poppins", system-ui, sans-serif;
            color: #1B2240;
            text-align: center;
        }

        .rl-differences-section h2 {
            color: #3E53A5;
            font-weight: 800;
            font-size: clamp(24px, 2.6vw, 32px);
            margin-bottom: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .rl-differences-section h2::before {
            content: "üíé";
            font-size: 1.4em;
            animation: shine 2.5s infinite ease-in-out;
        }

        @keyframes shine {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.6;
                transform: scale(1.1);
            }
        }

        .rl-differences-section p.subtitle {
            font-size: 16px;
            color: #4B569A;
            margin-bottom: 45px;
        }

        .rl-differences-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: 20px;
            max-width: 1100px;
            margin: 0 auto 50px;
        }

        .rl-diff-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px 20px;
            box-shadow: 0 6px 18px rgba(62, 83, 165, 0.08);
            font-size: 15.5px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: flex-start;
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            opacity: 0;
            transform: translateY(20px);
            text-align: left;
        }

        .rl-diff-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .rl-diff-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 22px rgba(62, 83, 165, 0.12);
        }

        .rl-diff-card:nth-child(3n+1) {
            background: linear-gradient(180deg, #FFFFFF 0%, #F9FBFF 100%);
        }

        .rl-diff-card:nth-child(3n+2) {
            background: linear-gradient(180deg, #FFFFFF 0%, #F5F8FF 100%);
        }

        .rl-diff-card:nth-child(3n+3) {
            background: linear-gradient(180deg, #FFFFFF 0%, #EEF3FF 100%);
        }

        @media (max-width: 600px) {
            .rl-differences-section {
                padding: 50px 16px;
                text-align: left;
            }

            .rl-differences-grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }

            .rl-diff-card {
                font-size: 15px;
                padding: 14px 18px;
                justify-content: flex-start;
            }

            .rl-diff-card span {
                display: inline-block;
                min-width: 22px;
            }
        }

        .rl-diff-footer {
            background: #E8EDFF;
            border-radius: 14px;
            padding: 22px 18px;
            max-width: 700px;
            margin: 0 auto;
            box-shadow: 0 4px 12px rgba(62, 83, 165, 0.08);
        }

        .rl-diff-footer p {
            font-weight: 600;
            color: #1B2240;
            font-size: 16px;
            margin: 0;
        }
    </style>

    <section class="rl-differences-section">
        <h2>Why RabaisLocal is different</h2>
        <p class="subtitle">Here are 16 reasons that clearly show RabaisLocal is nothing like a traditional MLM üëá</p>

        <div class="rl-differences-grid">
            <div class="rl-diff-card">üíé 1. No mandatory purchase</div>
            <div class="rl-diff-card">üí∏ 2. Zero pocket fees</div>
            <div class="rl-diff-card">ü§ù 3. Lifetime commissions on your referrals</div>
            <div class="rl-diff-card">üö´ 4. No mandatory recruiting</div>
            <div class="rl-diff-card">‚öôÔ∏è 5. Full automation thanks to AI</div>
            <div class="rl-diff-card">üåé 6. Controlled growth by region</div>
            <div class="rl-diff-card">üîí 7. Your rank remains acquired</div>
            <div class="rl-diff-card">üè™ 8. Real positive impact for local businesses</div>
            <div class="rl-diff-card">ü§ñ 9. AI working for you continuously</div>
            <div class="rl-diff-card">üß© 10. Unique and ethical hybrid model</div>
            <div class="rl-diff-card">üéÅ 11. You refer, AI handles the sale</div>
            <div class="rl-diff-card">üå± 12. 100% passive and scalable income</div>
            <div class="rl-diff-card">üßò 13. No performance pressure</div>
            <div class="rl-diff-card">üí• 14. 100% independent Quebec launch</div>
            <div class="rl-diff-card">üéØ 15. Mission before profit</div>
            <div class="rl-diff-card">üí° 16. Evolution based on concrete results</div>
        </div>

        <div class="rl-diff-footer">
            <p>üí¨ At <strong>RabaisLocal</strong> every difference has a goal to build a model: <u>ethical, sustainable,
                    and winning for everyone</u>.</p>
        </div>
    </section>

    <!-- ==========================================================
BLOCK 3 - Footer
========================================================== -->
    <style>
        .rl-footer {
            background: #fff;
            border-top: 2px solid #E0E6FF;
            text-align: center;
            font-family: "Poppins", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            color: #444;
            padding: 35px 16px 25px;
            font-size: 14.5px;
            line-height: 1.6;
        }

        .rl-footer a {
            color: #3E53A5;
            font-weight: 600;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .rl-footer a:hover {
            color: #2E408D;
            text-decoration: underline;
        }

        .rl-footer .divider {
            margin: 0 8px;
            color: #999;
        }

        .rl-footer small {
            display: block;
            color: #777;
            margin-top: 8px;
            font-size: 13px;
        }

        @media (max-width: 600px) {
            .rl-footer {
                font-size: 13.5px;
                padding: 28px 10px 22px;
            }
        }
    </style>

    <footer class="rl-footer">
        <p>
            ¬© 2025 <b>RabaisLocal</b>. All rights reserved.
            <span class="divider">|</span>
            <a href="test_en_politique-confidentialite.html" target="_blank">Privacy Policy</a>
            <span class="divider">|</span>
            <a href="mailto:support@rabaislocal.com">support@rabaislocal.com</a>
        </p>
        <small>100% Quebec platform. Secure payment via PayPal.</small>
    </footer>

    <!-- ==========================================================
SCRIPTS - REF MANAGEMENT + FORM VALIDATION
========================================================== -->
    <script>
        // ===== REFERRER "REF" MANAGEMENT =====
        const urlParams = new URLSearchParams(window.location.search);
        let ref = urlParams.get("ref") || localStorage.getItem("rl_ref") || "0";

        // Save to localStorage
        localStorage.setItem("rl_ref", ref);

        // Fill hidden fields
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById('ref').value = ref;
            document.getElementById('referer').value = ref; // Auto-fill with URL ref code

            // Check user location
            checkUserLocation();
        });

        // Debug log
        console.log("Sponsor Reference:", ref);

        // ===== LOCATION DETECTION =====
        let userCountry = null;

        function checkUserLocation() {
            console.log('üåç Checking location...');

            // Use ipapi.co to detect country (free, no API key needed)
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    userCountry = data.country_code;
                    const countryName = data.country_name;

                    console.log('üìç Detected country:', countryName, '(' + userCountry + ')');

                    if (userCountry !== 'CA') {
                        // Show visual warning
                        const warningBox = document.getElementById('location-warning');
                        const detectedCountrySpan = document.getElementById('detected-country');

                        if (warningBox && detectedCountrySpan) {
                            detectedCountrySpan.textContent = countryName;
                            warningBox.style.display = 'block';

                            // Scroll to warning
                            setTimeout(() => {
                                warningBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            }, 500);
                        }
                    }
                })
                .catch(err => {
                    console.warn('‚ö†Ô∏è Unable to check location:', err);
                    // On error, continue anyway (not blocking)
                });
        }

        // ===== PROPAGATE REF TO LINKS =====
        function propagateRef() {
            const currentRef = localStorage.getItem("rl_ref") || "0";
            document.querySelectorAll("[data-append-ref='true']").forEach(link => {
                try {
                    const url = new URL(link.href);
                    url.searchParams.set("ref", currentRef);
                    link.href = url.toString();
                } catch (e) {
                    console.error("REF propagation error:", e);
                }
            });
        }

        document.addEventListener("DOMContentLoaded", propagateRef);

        // ===== REGISTRATION FORM VALIDATION AND WEBHOOK SEND =====
        document.addEventListener("DOMContentLoaded", function () {
            const btnSubmitInscription = document.getElementById('btn-submit-inscription');
            const formInscription = document.getElementById('form-inscription-affilie');
            const paypalHostedForm = document.getElementById('paypal-hosted-form');
            const emailField = document.getElementById('email');

            // Visual validation + remove spaces for email
            if (emailField) {
                emailField.addEventListener('input', function (e) {
                    const sanitized = (e.target.value || '').replace(/\s/g, '');
                    e.target.value = sanitized;
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
                    e.target.classList.remove('valid', 'invalid');
                    if (sanitized.length === 0) return;
                    if (emailRegex.test(sanitized)) {
                        e.target.classList.add('valid');
                    } else {
                        e.target.classList.add('invalid');
                    }
                });
            }

            if (btnSubmitInscription && formInscription && paypalHostedForm) {
                btnSubmitInscription.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Validate registration form
                    if (!formInscription.checkValidity()) {
                        formInscription.reportValidity();
                        return;
                    }

                    // Generate unique ID to link form and PayPal payment
                    const uniqueId = 'RL-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

                    // Inject unique ID into PayPal hidden field
                    document.getElementById('paypal-custom-id').value = uniqueId;

                    // Get registration form data (simplified)
                    const email = document.getElementById('email').value.trim();
                    const referer = document.getElementById('referer').value.trim();

                    // Prepare webhook data
                    const formData = {
                        type: 'formulaire_inscription_affilie',
                        source: 'page2_avant_paiement',
                        transaction_id: uniqueId,
                        ref: ref,
                        email: email,
                        referer: referer,
                        timestamp: new Date().toISOString()
                    };

                    console.log('üìã Sending registration form data to webhook:', formData);

                    // Send to Make.com webhook (without waiting for response)
                    fetch('https://hook.us2.make.com/2yh1km3xxqenpgy6r6kf8pol3v4pcg63', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData),
                        keepalive: true
                    }).then(response => {
                        console.log('‚úÖ Registration data sent. Status:', response.status);
                    }).catch(err => {
                        console.error('‚ùå Error sending:', err);
                    });

                    // Save to localStorage
                    localStorage.setItem('rl_affilie_email', email);
                    localStorage.setItem('rl_affilie_referer', referer);
                    localStorage.setItem('rl_affilie_transaction_id', uniqueId);

                    // Propagate ref in PayPal redirect URLs
                    const returnUrlInput = paypalHostedForm.querySelector('input[name="return"]');
                    const cancelUrlInput = paypalHostedForm.querySelector('input[name="cancel_return"]');

                    if (returnUrlInput && ref) {
                        // MODIFIED FOR TEST MODE
                        returnUrlInput.value = 'https://marketing.rabaislocal.com/test_en_page2_form_affilie.html?ref=' + encodeURIComponent(ref);
                    }
                    if (cancelUrlInput && ref) {
                        // MODIFIED FOR TEST MODE
                        cancelUrlInput.value = 'https://marketing.rabaislocal.com/test_en_page2-affilie.html?ref=' + encodeURIComponent(ref);
                    }

                    // Check location before opening PayPal
                    if (userCountry && userCountry !== 'CA') {
                        const confirmPayment = confirm(
                            '‚ö†Ô∏è WARNING\n\n' +
                            'We detect that you are not in Canada (detected country: ' + userCountry + ').\n\n' +
                            'If you use a VPN, please DISABLE it before continuing.\n\n' +
                            'PayPal must show "Canada" as the country and "CAD" as the currency.\n\n' +
                            'Do you still want to proceed to PayPal?'
                        );

                        if (!confirmPayment) {
                            console.log('‚ùå Payment cancelled by user (non-Canada location)');
                            return; // Stop process
                        }
                    }

                    // Disable button to prevent double clicks
                    btnSubmitInscription.disabled = true;
                    btnSubmitInscription.textContent = 'Opening PayPal...';
                    btnSubmitInscription.style.opacity = '0.6';
                    btnSubmitInscription.style.cursor = 'not-allowed';

                    // Detect in-app browsers (Messenger, Facebook, Instagram, TikTok, etc.)
                    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                    const isInAppBrowser = /FBAN|FBAV|Instagram|Messenger|FB_IAB|TikTok|Line|Snapchat|WhatsApp/i.test(userAgent);

                    if (isInAppBrowser) {
                        // In-app browser: open PayPal in same window
                        console.log('üì± In-app browser detected - Opening PayPal in same window');
                        paypalHostedForm.target = '_top';
                    } else {
                        // Standard browser: open PayPal in centered popup
                        console.log('üñ•Ô∏è Standard browser - Opening PayPal in popup');
                        const width = 800;
                        const height = 700;
                        const left = (screen.width - width) / 2;
                        const top = (screen.height - height) / 2;

                        window.open('', 'paypal_popup',
                            'width=' + width +
                            ',height=' + height +
                            ',top=' + top +
                            ',left=' + left +
                            ',resizable=yes,scrollbars=yes,status=yes'
                        );
                        paypalHostedForm.target = 'paypal_popup';
                    }

                    // Submit PayPal form
                    paypalHostedForm.submit();

                    // Reactivate button after 3 seconds (in case user comes back)
                    setTimeout(function () {
                        btnSubmitInscription.disabled = false;
                        btnSubmitInscription.textContent = 'Validate and proceed to PayPal payment ‚Üí';
                        btnSubmitInscription.style.opacity = '1';
                        btnSubmitInscription.style.cursor = 'pointer';
                    }, 3000);
                });
            }
        });

        // ===== CARDS APPEARANCE ANIMATION =====
        document.addEventListener("DOMContentLoaded", () => {
            const cards = document.querySelectorAll(".rl-diff-card");
            const observer = new IntersectionObserver(entries => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            entry.target.classList.add("visible");
                        }, index * 50);
                    }
                });
            }, { threshold: 0.1 });

            cards.forEach(card => observer.observe(card));
        });
    </script>

</body>

</html>