<!-- ====== BANDEAU COOKIES RABAISLOCAL – version instantanée corrigée ====== -->
<script>
(function(){
const KEY='rlConsent';
const STYLENAME='rlCookieStyle2025';
const BARID='rlCookieBar';
const MODALID='rlCookieModal';

// Style
if(!document.getElementById(STYLENAME)){
 const css=`.rl-cookie-bar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #E3E8FF;
 box-shadow:0 -6px 24px rgba(0,0,0,.08);z-index:999999;font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#1B2240}
 .rl-cookie-wrap{max-width:1100px;margin:0 auto;padding:12px 16px;display:flex;gap:16px;align-items:center}
 .rl-cookie-text{font-size:14px;line-height:1.5;flex:1}
 .rl-cookie-actions{display:flex;gap:8px}
 .rl-btn{border:none;border-radius:8px;padding:10px 14px;font-weight:600;cursor:pointer}
 .rl-btn-primary{background:#3E53A5;color:#fff}
 .rl-btn-ghost{background:#F5F8FF;color:#1B2240;border:1px solid #E3E8FF}
 .rl-cookie-link{color:#3E53A5;text-decoration:underline}
 .rl-cookie-modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:1000000}
 .rl-cookie-card{background:#fff;border-radius:14px;width:min(680px,92vw);padding:22px;border:1px solid #E3E8FF}
 .rl-cookie-card h3{margin:0 0 10px;color:#3E53A5}
 .rl-row{display:flex;justify-content:space-between;align-items:center;border:1px solid #E3E8FF;border-radius:10px;padding:10px 12px;margin:8px 0}
 .rl-switch{position:relative;width:48px;height:26px;background:#E3E8FF;border-radius:999px;cursor:pointer}
 .rl-switch input{display:none}
 .rl-switch span{position:absolute;top:3px;left:3px;width:20px;height:20px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.2);transition:.2s}
 .rl-switch input:checked+span{left:25px;background:#3E53A5}
 @media(max-width:720px){.rl-cookie-wrap{flex-direction:column;align-items:flex-start}}`;
 const s=document.createElement('style');s.id=STYLENAME;s.textContent=css;document.head.appendChild(s);
}

// Si consentement déjà enregistré → ne rien afficher
try{if(localStorage.getItem(KEY)){return;}}catch(e){}

// HTML du bandeau + modal
const htmlBar=`<div class="rl-cookie-wrap">
 <div class="rl-cookie-text">
 Nous utilisons des cookies pour assurer le bon fonctionnement du site et améliorer ton expérience.
 <a class="rl-cookie-link" href="/politique-cookies">En savoir plus</a>.
 </div>
 <div class="rl-cookie-actions">
   <button class="rl-btn rl-btn-ghost" id="rlRefuse">Refuser</button>
   <button class="rl-btn rl-btn-ghost" id="rlPrefs">Personnaliser</button>
   <button class="rl-btn rl-btn-primary" id="rlAccept">Accepter</button>
 </div>
</div>`;
const bar=document.createElement('div');
bar.id=BARID;
bar.className='rl-cookie-bar';
bar.innerHTML=htmlBar;
document.body.appendChild(bar);

const modal=document.createElement('div');
modal.id=MODALID;
modal.className='rl-cookie-modal';
modal.innerHTML=`<div class="rl-cookie-card">
 <h3>Préférences des cookies</h3>
 <div class="rl-row"><div><strong>Nécessaires</strong> – indispensables (toujours actifs)</div>
   <div class="rl-switch"><input type="checkbox" checked disabled><span></span></div></div>
 <div class="rl-row"><div><strong>Mesure d’audience</strong> (Analytics)</div>
   <label class="rl-switch"><input type="checkbox" id="cAnalytics"><span></span></label></div>
 <div class="rl-row"><div><strong>Fonctionnels</strong> (confort d’usage)</div>
   <label class="rl-switch"><input type="checkbox" id="cFunctional"><span></span></label></div>
 <div class="rl-row"><div><strong>Marketing</strong> (Meta, TikTok, YouTube)</div>
   <label class="rl-switch"><input type="checkbox" id="cMarketing"><span></span></label></div>
 <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
   <button class="rl-btn rl-btn-ghost" id="rlCancel">Annuler</button>
   <button class="rl-btn rl-btn-primary" id="rlSave">Enregistrer</button>
 </div></div>`;
document.body.appendChild(modal);

// Fonctions
function hideNow(){
 const b=document.getElementById(BARID);
 const m=document.getElementById(MODALID);
 if(b) b.style.opacity='0';
 setTimeout(()=>{ if(b) b.remove(); if(m) m.remove(); },300);
 try{window.parent.postMessage({rlCookieCmd:'hide'},'*');}catch(e){}
}
function saveConsent(obj){
 try{localStorage.setItem(KEY,JSON.stringify(obj));}catch(e){}
 hideNow();
}

// Écoute boutons
function qs(id){return document.getElementById(id);}
qs('rlAccept').onclick=()=>saveConsent({analytics:true,functional:true,marketing:true});
qs('rlRefuse').onclick=()=>saveConsent({analytics:false,functional:false,marketing:false});
qs('rlPrefs').onclick=()=>qs(MODALID).style.display='flex';
qs('rlSave').onclick=()=>{
 const c={analytics:qs('cAnalytics').checked,functional:qs('cFunctional').checked,marketing:qs('cMarketing').checked};
 saveConsent(c);
};
qs('rlCancel').onclick=()=>qs(MODALID).style.display='none';

// Compat iframe
window.addEventListener('message',e=>{
 if(e&&e.data&&e.data.rlCookieCmd==='hide'){hideNow();}
});
})();
</script>